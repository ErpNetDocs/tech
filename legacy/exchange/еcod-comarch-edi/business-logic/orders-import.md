## Импорт на поръчки

Този тип задачи позволява импортиране на Commarch-bg ECOD Order xml файлове в ERP.net база данни.

Данните се импортират в документ тип Продажба.


### Алгоритъм за определяне на субектите при импорт на поръчки от ECOD

Алгоритъм за определяне на субектите в EnterpriseOne при импорт на поръчки от ECOD.  
 
<br/>

**Определянето на Клиент, Собствена фирма, От Направление, Към направление и Доставяне на клиент се прави по следния алгоритъм:**
> **_ЗАБЕЛЕЖКА:_** Този алгоритъм се изпoлзва, когато е отметната отметката "Използване на Номер на локация на субект". 
Ако не е отметната се гледат полетата GLN в субектите.

**1.** Установява се Собствената фирма:

    1.1. Търси се измежду собствените фирми фирма с Location Number = Seller ILN, Partner Location Number = Buyer  ILN и Location Coding System = GLN. 

    1.2. Ако не намери фирма в т. 1.1.  то търси фирма с Location Number = Seller ILN, Partner Location Number = Null и Location Coding System = GLN

    1.3. Ако не намери фирма в т. 1.1. и 1.2.  използва настройката в задачата за определяне на Собствена фирма по подразбиране.

**2.** Установява се Клиент - фирма, за която Location Number = Buyer  ILN, Location Coding System = GLN  и Собствена фирма от т.1.

**3.** Установява се "От направление". Това се прави в зависимост от Характеристика за клиент „ECOD_Company_Division ECOD попълване на направление“:

    3.1. Ако характеристиката има стойност „Попълва се по CodeByBuyer“ то направлението се установява по Code (Код на направление) = CodeByBuyer таг в импортния файл. Ако не намери направление хвърля грешка.

    3.2. Ако характеристиката има стойност „Попълва се по GLN“ то се издирва направлението по по Location Number = Seller ILN, Partner Location Number = Buyer  ILN и Location Coding System е GLN.  Ако не намери направление хвърля грешка.

**4.** Установява се "Към направление". Направлението се определя, като се търси направление на Клиент от т.2 със същия Код, като направлението от т.3. Ако в т.3 не е намерено направление – остава празно.

**5.** Установява се Доставяне а клиент в зависимост от опцията "Определяне на Доставяне на клиент" в задачата:

    5.1. Ако стойността е „Dlivery Point“ се определя обект за който Location Number = DliveryPoint ILN и Location Coding System = GLN и след това Клиент обект в зависимост от собствената фирма от 1.

    5.2. Ако стойността е „Order By“  се определя обект за който Location Number =  OrderBy ILN и Location Coding System е GLNи след това Клиент обект в зависимост от собствената фирма от 1.

 

Входните данни от файла са: Seller ILN, Buyer  ILN, CodeByBuyer, DliveryPoint ILN, OrderBy ILN
