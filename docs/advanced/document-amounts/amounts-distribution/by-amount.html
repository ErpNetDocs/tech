<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Amount distribution by amount | ERP.net Tech Docs </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Amount distribution by amount | ERP.net Tech Docs ">
    <meta name="generator" content="docfx 2.56.9.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="amount-distribution-by-amount">Amount distribution by amount</h1>

<p>When distributing by amount, to define the distribution proportions rows amounts are used. Two types of amounts are used:</p>
<ul>
<li>row amounts (only if the additional amount has &quot;Based On Line&quot; is True);</li>
<li>the amounts that are distributed to the rows (only the ones which  participate in the base amount of the current additional amount).</li>
</ul>
<p>So, to define the proportion of row <strong>i</strong>, its coefficient is calculated (initially) as follows:</p>
<p>[<strong>ki</strong>] = [distributed to row <strong>i</strong> amount1] + [distributed to row <strong>i</strong> amount2] + ... + [distributed to row <strong>i</strong> amountm].</p>
<p>So amount1, amount2 ... amountm are the additional amounts, to which we add the current additional amount  that is distributed (i.e. the amounts, that are listed in its definition in the &quot;Document Amount Type Dependencies&quot; panel). If there are no such amounts, than in this initial calculation we have [<strong>ki</strong>] = <strong>0</strong>. Also if &quot;Base On Lines&quot; is true (in the current additional amount), than to the initial value for [<strong>ki</strong>] the row amount is added.</p>
<p>[<strong>ki</strong>] = [<strong>ki</strong>] + [row <strong>i</strong> amount].</p>
<p>This is how each row coefficient is calculated. After that the distribution  is performed as usual, except for the case when the amount [<strong>S</strong>] is <strong>0</strong> and the additional amount is calculated as a percent. In this case the  amount is distributed equally through the rows and for each row the  calculation is performed like this:</p>
<p>[row <strong>i</strong> distribution] = ROUND([<strong>ki</strong>] * [Input Percent], [Round Scale).</p>
<p>The idea behind this special case is that if a percent is used for the  additional amount calculation, than this percent may be used for the  calculation of the distributed amount for each row (i.e. to multiply the percent by [<strong>ki</strong>], which is the base amount only for the <strong>i</strong> row). Hereby, we avoid the disadvantage of the even distribution - the amount distributed to a certain row maynot be equal to the input percent (this is huge problem, for example, in cases like VAT). <em>Example 2,</em> below, demonstrate such distribution.</p>
<p><em>Example 1:</em></p>
<p>There are the following additional amounts:</p>
<ul>
<li><p>Corporate Discount:</p>
<ul>
<li>Input Percent: <strong>-3%</strong>;</li>
<li>Distributed By: <strong>Amount</strong>;</li>
<li>Round Scale: <strong>2</strong>;</li>
<li>Base On Line: <strong>True</strong>.</li>
</ul>
</li>
<li><p>Eastern Bonus:</p>
<ul>
<li><p>Distributed By: <strong>Amount</strong>;</p>
</li>
<li><p>Round Scale: <strong>2</strong>;</p>
</li>
<li><p>Input Amount: <strong>-10 EUR</strong>.</p>
</li>
</ul>
</li>
<li><p>VAT:</p>
<ul>
<li>Input Percent: <strong>20%</strong>;</li>
<li>Distributed By: <strong>Amount</strong>;</li>
<li>Round Scale: <strong>2</strong>;</li>
<li>Base On Line: <strong>True</strong>;</li>
<li>in &quot;Document Amount Type Dependencies&quot; panel is listed that the VAT is  applied also on &quot;Cosporate Discount&quot; and &quot;Easter Bonus&quot; additional  amounts;</li>
</ul>
</li>
</ul>
<p>The document has two rows: row \#10 for <strong>150 EUR</strong> and row \#20 for <strong>40 EUR</strong>. In <a href="https://github.com/ErpNetDocs/tech/blob/master/advanced/documents/additional-amounts/amounts-calculation/percent-calculation.md">Percent Value Calculation</a> is explained how the additional amounts are calculated:</p>
<p>[Corporate Discount] = -<strong>5.70 EUR</strong></p>
<p>[Eastern Bonus] = <strong>-10 EUR</strong></p>
<p>[VAT] = <strong>34.86 EUR</strong></p>
<p>So for the distribution of Corporate Discount there are the following coefficients [<strong>k1</strong>] = <strong>150</strong> and [<strong>k2</strong>] = <strong>40</strong> (only the base line amounts are taken into account). So the [Corporate Discount] is distributed in 150:40 ratio as follows:</p>
<p>[Corporate Discount for row #10] = -5.70 EUR * 150 / 190 = <strong>-4.50 EUR</strong>;
[Corporate Discount for row #20] = -5.70 EUR * 40 / 190 = <strong>-1.20 EUR</strong>.</p>
<p>For the next amount - &quot;Easter Bonus&quot; - the distribution is in the same ratio 150:40. The result is:.</p>
<p>[Easter Bonus for row #10] = -10 EUR * 150 / 190 = -7.894736842105263 EUR ~ <strong>-7.89 EUR</strong>;
[Easter Bonus for row #20] = -10 EUR * 40 / 190 = -2.105263157894737 EUR ~ <strong>-2.11 EUR</strong>.</p>
<p>For the last additional amount, the coefficients are different, because the distributed amounts from the other additional amounts haveto be  added to the row amounts. So the coefficients are as follows:</p>
<p>[<strong>k1</strong>] = [Corporate Discount for row #10] + [Easter Bonus for row #10] + [line amount for row #10] = -4.5 + -7.89 + 150 = 137.61;
[<strong>k2</strong>] = [Corporate Discount for row #20] + [Easter Bonus for row #20] + [line amount for row #20] = -1.2 + -2.11 + 40 = 36.69.</p>
<p>So the VAT distribution is as follows:</p>
<p>[VAT for row #10] = 34.86 EUR * 137.61 / 174.3 = 27.522 EUR ~ <strong>27.52 EUR</strong>;
[VAT for row #20] = 34.86 EUR * 36.69 / 174.3 = 7.338 EUR ~ <strong>7.34 EUR</strong>.</p>
<p><em>Example 2:</em></p>
<p>There are <strong>20%</strong> VAT and three document rows - row #10 with <strong>100 EUR,</strong> row #20 with <strong>-30 EUR</strong> and row #30 for <strong>-70 EUR</strong>. In this case the VAT is <strong>0 EUR</strong>, but it is not appropriate to distribute <strong>0 EUR</strong> on each row (no matter what the coefficients are), as by law each row  separately must have nonzero VAT. Even if for some reason (for example  specifing roundings) the VAT is not equal to <strong>0</strong>, than it is not appropriate to distribute it equally through the rows (as it will be if we distribute by quantity and we have [<strong>S</strong>] = <strong>0</strong>), because the amounts on each row are different. This is the reason why  in these cases a specific calculation of the distributed amounts is  applied:</p>
<p>[VAT for row #10] = 100 EUR* 0.2 = <strong>20 EUR</strong>;
[VAT for row #20] = -30 EUR * 0.2 = <strong>-6 *<em>EUR*</em></strong>;
[VAT for row #30] = -70 EUR * 0.2 = <strong>-14 *<em>EUR*</em></strong>.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong>  note text Also there is a specific case when the additional amount is distributed by  amount. If some rows/coefficients in the document are positive and some  of them are negative - as it is discribed in <a href="https://github.com/ErpNetDocs/tech/blob/master/advanced/documents/additional-amounts/amounts-calculation/percent-calculation.md">Percent Value Calculation</a>, in these cases except the total amount of the additional amount there  are also two subtotals - positive amount/part and negative amount/part.  The amount distribution is performed in two stages - at first the positive subtotals are distributed throught the rows with positive  amounts and then the negative subtotal is distributed throught the rows  with negative amounts.</p>
</blockquote>
<p><em>Example 3:</em></p>
<p>There is an additional amount VAT with input percent <strong>20%</strong>  and three document rows - row #10 with amount of <strong>74 EUR</strong>, row #20 with amount of <strong>26 EUR</strong> and row #30 with amount of <strong>-45 EUR</strong>. The VAT amount is <strong>11 EUR</strong> and the the subtotals are [positive VAT] = <strong>20 EUR</strong> and [negative VAT] = <strong>-9 EUR</strong>. Then at first the <strong>20 EUR</strong> are distributed on row #10 and row #20 in 74:26 ratio:</p>
<p>[VAT for row #10] = 20 EUR * 74 / 100 = <strong>14.80 EUR</strong>;</p>
<p>[VAT for row #20] = 20 EUR * 26 / 100 = <strong>5.20 EUR</strong></p>
<p>And than the [negative VAT] subtotal is distributed on the last document row: [negative VAT] = <strong>-9 EUR</strong> = [VAT for row #30]</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/ErpNetDocs/tech/blob/master/advanced/document-amounts/amounts-distribution/by-amount.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
