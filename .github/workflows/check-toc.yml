name: Check DocFX TOC changes

on:
  workflow_dispatch:
    inputs:
      target_path:
        description: "–ü–∞–ø–∫–∞—Ç–∞, –∑–∞ –∫–æ—è—Ç–æ –¥–∞ —Å–µ –ø—Ä–æ–≤–µ—Ä–∏ TOC (–ø—Ä–∏–º–µ—Ä: docs/operators)"
        required: true
        default: "docs"

permissions:
  contents: read

jobs:
  preview-toc:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml

      - name: Run TOC generator (dry-run)
        env:
          TARGET_PATH: ${{ inputs.target_path }}
        run: |
          PY_SCRIPT="gen_docfx_root_toc_v4.py"
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º TOC –∑–∞: $TARGET_PATH"
          python "$PY_SCRIPT" --root "$TARGET_PATH" --write --auto-create-subdirs --update-parent --require-sub-index --verbose

      - name: Show changed files
        run: |
          echo "üìÑ –ü—Ä–æ–º–µ–Ω–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ:"
          git status --short
          echo
          echo "üëâ –ü—Ä–µ–≥–ª–µ–¥–∞–π –≥–æ—Ä–Ω–∏—è —Å–ø–∏—Å—ä–∫. –ê–∫–æ –≤—Å–∏—á–∫–æ –∏–∑–≥–ª–µ–∂–¥–∞ –Ω–∞—Ä–µ–¥, –ø—É—Å–Ω–∏ 'update-toc.yml', –∑–∞ –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏ commit."
